name: Update Repository Metadata

on:
  schedule:
    - cron: '0 0 * * *' # Run daily at midnight
  workflow_dispatch: # Allow manual triggers

permissions:
  contents: read

jobs:
  update-metadata:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - id: get-workflow-access-token
        name: Get Workflow Access Token
        uses: actions/create-github-app-token@df432ceedc7162793a195dd1713ff69aefc7379e # v2.0.6
        with:
          app-id: ${{ secrets.APPLICATION_ID }}
          private-key: ${{ secrets.APPLICATION_PRIVATE_KEY }}

      - name: Update repository metadata
        uses: ./.github/actions/update-metadata
        with:
          token: ${{ steps.get-workflow-access-token.outputs.token }}
          node-version: '20'
          autofix: 'true'
          pr-branch: ci/update-metadata
          commit-message: 'chore: update repository metadata'
          pr-title: 'chore: update repository metadata'
          pr-body: |
            This PR updates the repository metadata files based on the latest organization scan.
            Please review the changes and merge this pull request if you approve.
            <sup>
            _This PR is automatically generated by the [update-metadata][1] workflow ([##${{ github.run_number }}][2])._
            </sup>
            [1]: https://github.com/${{ github.repository }}/blob/main/.github/workflows/update-metadata.yaml 'Update Metadata Workflow'
            [2]: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }} 'Workflow Run'
          skip-changeset: 'false'
